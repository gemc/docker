#
# gemc docker 2.9 (jlabce 2.5) libraries image
# --------------------------------------------------------------------------
#
# To manually build and push the container (use --no-cache to force rebuild):
#
#  docker pull jeffersonlab/jlabce:2.5g2
#  docker build --progress=plain            -f Dockerfile-2.9 -t gemc:2.9 .
#  docker build --progress=plain --no-cache -f Dockerfile-2.9 -t gemc:2.9 .
#
#  docker tag gemc:2.9 jeffersonlab/gemc:2.9
#  docker tag gemc:2.9 jeffersonlab/jlabce:2.5
#
#  docker push jeffersonlab/gemc:2.9
#  docker push jeffersonlab/jlabce:2.5
#
# --------------------------------------------------------------------------
#
# To run in batch mode:
#
#  docker run -it --rm -v ~/mywork:/jlab/work/mywork              gemc:2.9 bash
#
#  docker run -it --rm -v ~/mywork:/jlab/work/mywork jeffersonlab/gemc:2.9 bash
#
# --------------------------------------------------------------------------

FROM jeffersonlab/jlabce:2.5g2
LABEL maintainer "Maurizio Ungaro <ungaro@jlab.org>"

ENV JLAB_ROOT /jlab
ENV JLAB_VERSION 2.5

WORKDIR $JLAB_ROOT

RUN cd $JLAB_ROOT/$JLAB_VERSION/install \
	&& source $JLAB_ROOT/$JLAB_VERSION/ce/jlab.sh \
	&& ./go_mlibrary \
	&& rm -rf $JLAB_SOFTWARE/mlibrary/*.gz \
	&& rm -rf $JLAB_SOFTWARE/mlibrary/*/cadmesh*

RUN cd $JLAB_ROOT/$JLAB_VERSION/install \
	&& source $JLAB_ROOT/$JLAB_VERSION/ce/jlab.sh \
	&& ./go_gemc src \
	&& ./go_gemc make \
	&& rm -rf $JLAB_SOFTWARE/gemc/*.gz

RUN cd $JLAB_ROOT/$JLAB_VERSION/install \
	&& source $JLAB_ROOT/$JLAB_VERSION/ce/jlab.sh \
	&& ./go_banks

WORKDIR $JLAB_ROOT
CMD bash /container/utilities/xstart.sh && sleep infinity



