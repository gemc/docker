# gemc image - containing gemc2 or gemc3
# --------------------------------------------------------------------------
#
# docker_build_gemc_image        2.11 fedora36
# docker_run_gemc_image          2.11 fedora36 [i]
# docker_tag_and_push_gemc_image 2.11 fedora36
#
# --------------------------------------------------------------------------

FROM imagetemplate
LABEL maintainer="Maurizio Ungaro <ungaro@jlab.org>"

# run shell instead of sh
SHELL ["/bin/bash", "-c"]

ARG GEMC_VERSION="na"
ARG MODULE_TO_LOAD="na"
RUN echo "GEMC_VERSION=$GEMC_VERSION, MODULE_TO_LOAD=$MODULE_TO_LOAD"

ENV SIM_HOME /usr/local

WORKDIR $SIM_HOME

COPY install_gemc $SIM_HOME

RUN echo "module load $MODULE_TO_LOAD" >> $SIM_HOME/localSetup.sh \
    && cp $SIM_HOME/localSetup.sh /app/localSetup.sh \
    && cp $SIM_HOME/localSetup.sh /etc/profile.d/localSetup.sh

# gemc installation
RUN source /app/localSetup.sh \
    && cd $SIM_HOME/ceInstall \
    && git pull \
    && $SIM_HOME/install_gemc $GEMC_VERSION $SIM_HOME
